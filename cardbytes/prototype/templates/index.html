<title>Prototype</title>
{% load staticfiles %}

<link rel="stylesheet" href="{% static "css/materialize.min.css" %}">
<link rel="stylesheet" href="{% static "css/customer.css" %}">

<script type="text/javascript" src="{% static "js/jquery-2.2.1.min.js" %}"></script>           
<script type="text/javascript" src="{% static "js/materialize.min.js" %}"></script>


<div class="container">


<div id ='card_panel' class="row">
    <div class="col s12">
    
    <h4>CardBytes CLM prototype </h4>
  <div>
      <a id ="generate_offers" class="waves-effect waves-light btn">Generate offers</a>
      <script>
          $('#generate_offers').on('click',  function(){
            $.ajax({url: "http://localhost:8000/cardbytes/generate_offers?", 
              success: function(result){
            console.log('success');
            create_table();
            }});
          });
          </script>
    </div>
    </div>
    
      <div class="col s6">
      <div class="card blue-grey accent-3">
        <div class="card-content white-text">
         <p id = "bank_clm" >Bank Revenue with CLM  </p>
         <script>
      $(document).ready(function(){
        $.ajax({url: "http://localhost:8000/cardbytes/get_bank_revenue?", 
          success: function(result){
          var revenue = result['revenue_with_clm'];
          var div = document.getElementById('bank_clm');
          div.innerHTML += "<p class='white-text'>"+ revenue + "</p>" 
        }});
      });
      </script>
        </div>
      </div>
      </div>

<div class="col s6">
      <div class="card blue-grey accent-3">
        <div class="card-content white-text">
         <p id = 'card_revenue' >Cardbytes Revenue  </p>
      <script>
      $(document).ready(function(){
        $.ajax({url: "http://localhost:8000/cardbytes/get_vendor_revenue?", 
          success: function(result){
          var revenue = result['revenue'];
          var div = document.getElementById('card_revenue');
          div.innerHTML += "<p class='white-text'>"+ Math.floor(revenue) + "</p>" 
        }});
      });
      </script>
        </div>
      </div>
    
    </div>
    <div class="col s6">
      <div class="card blue-grey accent-3">
        <div class="card-content white-text">
         <p id = "bank_wo_clm" >Bank Revenue without CLM  </p>
         <script>
      $(document).ready(function(){
        $.ajax({url: "http://localhost:8000/cardbytes/get_bank_revenue?", 
          success: function(result){
          var revenue = result['revenue_without_clm'];
          var div = document.getElementById('bank_wo_clm');
          div.innerHTML += "<p class='white-text'>"+ revenue + "</p>" 
        }});
      });
      </script>
        </div>
      </div>
    </div>

    <div id="table" class="col s12">
        </div>

</div>
        

<script>

var create_table = function(){
        $.ajax({url: "http://localhost:8000/cardbytes/show_offers?", 
        	success: function(result){
        	console.log(result);
 		var div = document.getElementById('table');
       var html_code = "<table class='centered responsive-table highlight'>" +
       "<thead>" +
          "<tr>"+
             "<th data-field='id'>User</th>"+
             "<th data-field='merchant'>Merchant</th>"+
             "<th data-field='cashback'>Cashback (%)</th>"+
             "<th data-field='cashback_used'>Cashback Used</th>"+
          "</tr>"+
        "</thead>"+
        "<tbody>";
        offers = result['offers'];
        for(i=0; i < offers.length; i++){
       html_code += "<tr>";
       	
        	html_code += "<td>"+offers[i]['user_id']+"</td>";
        	html_code += "<td>"+offers[i]['merchant']+"</td>";
        	html_code += "<td>"+offers[i]['cashback']*100+"</td>";
        	html_code += "<td>"+offers[i]['cashback_used']+"</td>";
        	html_code += "</tr>";
        	
        }
        html_code += "</tbody>"+ "</table>";
        div.innerHTML = html_code;
    }});
}

// $(document).ready(create_table());

$('#generate_offers').on('click', create_table());

</script>
</div>
